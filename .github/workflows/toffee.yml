name: Toffee Multi-Category Update

on:
  schedule:
    - cron: "0 */3 * * *" # ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡ß© ‡¶ò‡¶£‡ßç‡¶ü‡¶æ ‡¶™‡¶∞‡¶™‡¶∞
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install Dependencies
        run: pip install requests

      - name: Run Master Scraper
        run: python toffee_all.py

      - name: Prevent Empty Push
        run: |
          # ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá ‡¶´‡¶æ‡¶á‡¶≤‡¶ü‡¶ø ‡¶Ü‡¶∏‡¶≤‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá ‡¶ï‡¶ø ‡¶®‡¶æ
          if [ ! -s toffee_all.m3u ] || [ "$(cat toffee_all.m3u)" = "#EXTM3U" ]; then
            echo "Warning: Data not found (IP Blocked). Keeping existing file."
            git checkout toffee_all.m3u
          fi

      - name: Commit and Push
        run: |
          git config --local user.email "bot@github.com"
          git config --local user.name "ToffeeBot"
          git add toffee_all.m3u
          git commit -m "üîÑ All Channels Updated: $(date)" || echo "No changes to commit"
          git push
